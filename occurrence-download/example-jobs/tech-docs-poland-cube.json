{
  "sendNotification": true,
  "creator": "MattBlissett",
  "notification_address": ["mblissett@gbif.org"],
  "format": "SQL_TSV_ZIP",
  "sql": "SELECT\n  PRINTF('%04d-%02d', \"year\", \"month\") AS yearMonth,\n  GBIF_EEARGCode(\n    1000,\n    decimalLatitude,\n    decimalLongitude,\n    COALESCE(coordinateUncertaintyInMeters, 1000)\n  ) AS eeaCellCode,\n  familyKey,\n  family,\n  speciesKey,\n  species,\n  COALESCE(sex, 'NOT_SUPPLIED') AS sex,\n  COALESCE(occurrence.lifestage.concept, 'NOT_SUPPLIED') AS lifestage,\n  COUNT(*) AS occurrences,\n  MIN(COALESCE(coordinateUncertaintyInMeters, 1000)) AS minCoordinateUncertaintyInMeters,\n  MIN(GBIF_TemporalUncertainty(eventDate, eventTime)) AS minTemporalUncertainty,\n  IF(ISNULL(familyKey), NULL, SUM(COUNT(*)) OVER (PARTITION BY familyKey)) AS familyCount\nFROM\n  occurrence\nWHERE occurrenceStatus = 'PRESENT'\n  AND countryCode = 'PL'\n  AND \"year\" >= 2000\n  AND kingdomKey = 1\n  AND hasCoordinate = TRUE\n  AND speciesKey IS NOT NULL\n  AND NOT ARRAY_CONTAINS(issue, 'ZERO_COORDINATE')\n  AND NOT ARRAY_CONTAINS(issue, 'COORDINATE_OUT_OF_RANGE')\n  AND NOT ARRAY_CONTAINS(issue, 'COORDINATE_INVALID')\n  AND NOT ARRAY_CONTAINS(issue, 'COUNTRY_COORDINATE_MISMATCH')\n  AND \"month\" IS NOT NULL\nGROUP BY\n  yearMonth,\n  eeaCellCode,\n  familyKey,\n  family,\n  speciesKey,\n  species,\n  sex,\n  lifestage\nORDER BY\n  yearMonth DESC,\n  eeaCellCode ASC,\n  speciesKey ASC;\n"
}
