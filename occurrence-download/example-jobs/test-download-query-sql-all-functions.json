{
  "sendNotification": true,
  "format": "SQL_TSV_ZIP",
  "sql": "\nSELECT\n  PRINTF('%04d-%02d', \"year\", \"month\") AS yearMonth,\n\n  GBIF_EEARGCode(1000, decimalLatitude, decimalLongitude, COALESCE(coordinateUncertaintyInMeters, 1000)) AS eeaCellCode,\n  GBIF_EQDGCode(    2, decimalLatitude, decimalLongitude, COALESCE(coordinateUncertaintyInMeters, 1000)) AS eqdgCellCode,\n  GBIF_DMSGCode(  300, decimalLatitude, decimalLongitude, COALESCE(coordinateUncertaintyInMeters, 1000)) AS dmsgCellCode,\n  GBIF_ISEA3HCode(  6, decimalLatitude, decimalLongitude, COALESCE(coordinateUncertaintyInMeters, 1000)) AS isea3hCellCode,\n  GBIF_MGRSCode( 1000, decimalLatitude, decimalLongitude, COALESCE(coordinateUncertaintyInMeters, 1000)) AS mgrsCellCode,\n\n  familyKey,\n  family,\n  speciesKey,\n  species,\n\n  CONCAT_WS(' | ', occurrence.typestatus.concepts) AS typeStatuses,\n  occurrence.typestatus.lineage AS typeStatusLineages,\n  COALESCE(occurrence.sex.concept, 'NOT_SUPPLIED') AS sex,\n\n  COUNT(*) AS occurrences,\n  MIN(COALESCE(coordinateUncertaintyInMeters, 1000)) AS minCoordinateUncertaintyInMeters,\n  MIN(GBIF_TemporalUncertainty(eventDate, null)) AS minTemporalUncertaintyDateOnly,\n  MIN(GBIF_TemporalUncertainty(eventDate, eventTime)) AS minTemporalUncertaintyDateTime,\n  GBIF_SecondsToLocalISO8601(MAX(eventDate)) AS latestDate,\n  GBIF_MillisecondsToISO8601(MAX(modified)) AS latestModified,\n  GBIF_SecondsToISO8601(MAX(dateIdentified)) AS identifiedDate\nFROM\n  occurrence\nWHERE occurrenceStatus = 'PRESENT'\n  AND \"year\" >= 1900\n  AND hasCoordinate = TRUE\n  AND (coordinateUncertaintyInMeters <= 1000 OR coordinateUncertaintyInMeters IS NULL)\n  AND speciesKey IS NOT NULL\n  AND NOT GBIF_STRINGARRAYCONTAINS(occurrence.issue, 'TAXON_MATCH_FUZZY', TRUE)\n  AND NOT ARRAY_CONTAINS(issue, 'ZERO_COORDINATE')\n  AND NOT GBIF_StringArrayContains(occurrence.recordedby, 'Matthew', FALSE)\n  AND \"month\" IS NOT NULL\n  AND (GBIF_GeoDistance(56.0, 12.0, '10km', decimalLatitude, decimalLongitude) = TRUE\n    OR GBIF_Within('POLYGON ((-64.8 32.3, -65.5 18.3, -80.3 25.2, -64.8 32.3))', decimalLatitude, decimalLongitude) = TRUE)\nGROUP BY\n  yearMonth,\n  eeaCellCode,\n  eqdgCellCode,\n  dmsgCellCode,\n  isea3hCellCode,\n  mgrsCellCode,\n  familyKey,\n  family,\n  speciesKey,\n  species,\n  typeStatuses,\n  typeStatusLineages,\n  sex\nORDER BY\n  yearMonth DESC,\n  eeaCellCode ASC,\n  speciesKey ASC;\n"
}
